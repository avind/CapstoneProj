---
title: "Capstone Project"
author: "Alex" 
date: "June 13, 2015"
output: html_document
---

#Results

```{r Data Cleaning, echo=FALSE, warning=FALSE, message=FALSE, results='hide'}
library(readr)
library(dplyr)

# Raw Data Import ####

#lib - readr
raw <- read_csv("1371_traffic_volumes.csv")
raw2 <- raw[-1:-2,] #remove extraneous rows (French and blank row) to allow "readr" to reparse variables types correctly
raw3 <- type_convert(raw2)
str(raw3) #check datatypes

#Rename columns ####
#lib - dplyr
renamed.raw <- rename(raw3, "lhrs" = LHRS,"OS" =`O/S`, "year" = Year, "hwy.num" = `Hwy #`, "hwy.let" = `Hwy Let`, "hwy.type" = `Hwy Type (Text)`, "location" = `Location Description`, "reg" = Reg, "section.len" = `Section Length`, "conn.link.len" = `Connecting Link Length`, "sec.description" = `Secondary Description (for Connecting Links, Regional Boundarys,etc)`, "travel.pattern" = `Travel Pattern`, "dhv.percent" = `DHV %`, "directional.split" = `Directional Split`, "aadt" = AADT, "annual.aadt.change" = `Yearly % Change in AADT`, "decade.change" = `10 Year % Change in AADT`, "sadt" = SADT, "sawdt" = SAWDT, "wadt" = WADT)

#Checking for NAs ####
length(renamed.raw$lhrs)
length(renamed.raw$year)
length(renamed.raw$aadt)
sum(is.na(renamed.raw$aadt))
sum(is.na(renamed.raw$sadt))
sum(is.na(renamed.raw$sawdt))
sum(is.na(renamed.raw$wadt))
sum(renamed.raw$year=="9999")
#there are 553 NA entries for aadt. year is also set to 9999 for these entries

#Removing NAs and duplicate entries ####
fil.data <- renamed.raw %>%
  distinct() %>%
  filter(year!="9999", travel.pattern!="UNC", travel.pattern!="UKN")

length(fil.data$year)
length(fil.data$aadt)
length(fil.data$travel.pattern)

glimpse(fil.data)

#convert travel.pattern and region to factor ####
fil.data$travel.pattern <-  factor(fil.data$travel.pattern)
fil.data$reg <- factor(fil.data$reg)
is.factor(fil.data$travel.pattern)

#grouping data by regions: Central, Eastern, Northeastern, Northwestern, West ####
central <- filter(fil.data, reg == "CR")
eastern <- filter(fil.data, reg == "ER")
noreast <- filter(fil.data, reg == "NE")
norwest <- filter(fil.data, reg == "NW")
west <- filter(fil.data, reg == "SW")

#select for the four highway types in the dataset
king <- filter(fil.data, hwy.type == "King")
secon <- filter(fil.data, hwy.type == "Sec")
fwy <- filter(fil.data, hwy.type == "Fwy")
tert <- filter(fil.data, hwy.type == "Tert")

```

##Exploration

```{r}

```
- Number of entries for each pattern
- 


###Boxplots
```{r Boxplots of Travel Patterns, echo=FALSE, warning= FALSE, message=FALSE}
library(ggplot2)
###Multiplot function ####
#From R Cookbook: http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot1)/

# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}

d1 <- ggplot(fil.data,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("All Regions") + xlab("AADT") +
  ylab("Frequency") 

d2 <- ggplot(central,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("Central") + xlab("AADT") +
  ylab("Frequency") 

d3 <- ggplot(eastern,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("Eastern") + xlab("AADT") +
  ylab("Frequency") 

d4 <- ggplot(noreast,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("Northeast") + xlab("AADT") +
  ylab("Frequency") 

d5 <- ggplot(norwest,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("Northwest") + xlab("AADT") +
  ylab("Frequency") 

d6 <- ggplot(west,aes(x=travel.pattern, y = aadt))+
  geom_boxplot(aes()) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_boxplot(colour="black", fill="grey") + ggtitle("Western") + xlab("AADT") +
  ylab("Frequency") 

multiplot(d1, d2, d3, d4, d5, d6, cols=3)
```

###AADT ~ Years
```{r AADT over Time, echo=FALSE, warning= FALSE, message=FALSE}
library(ggvis)

add_title <- function(vis, ..., x_lab = "X units", title = "Plot Title") 
{
  add_axis(vis, "x", title = x_lab) %>% 
    add_axis("x", orient = "top", ticks = 0, title = title,
             properties = axis_props(
               axis = list(stroke = "white"),
               title = list(fontSize = 26),
               labels = list(fontSize = 0)
             ), ...)
}

fwy %>% 
  ggvis(~year, ~aadt) %>%
  layer_smooths() %>%
  layer_model_predictions(model = "lm", stroke := "red", se = TRUE) %>%
  add_title(title = "Freeway", x_lab="Year")

king %>% 
  ggvis(~year, ~aadt) %>%
  layer_smooths() %>%
  layer_model_predictions(model = "lm", stroke := "red", se = TRUE) %>%
  add_title(title = "King's Highway", x_lab="Year")

secon %>% 
  ggvis(~year, ~aadt) %>%
  layer_smooths() %>%
  layer_model_predictions(model = "lm", stroke := "red", se = TRUE) %>%
  add_title(title = "Secondary Highway", x_lab="Year")

tert %>% 
  ggvis(~year, ~aadt) %>%
  layer_smooths() %>%
  layer_model_predictions(model = "lm", stroke := "red", se = TRUE) %>%
  add_title(title = "Tertiary Highway", x_lab="Year")


```

###Histograms
```{r Histogram of Regions, echo=FALSE, warning= FALSE, message=FALSE}

# Histograms ####

#describe distribution of patterns by region

library(ggplot2)

d1 <- ggplot(fil.data,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("All Regions") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)

d2 <- ggplot(central,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Central") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)

d3 <- ggplot(eastern,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Eastern") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)

d4 <- ggplot(noreast,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Northeast") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)

d5 <- ggplot(norwest,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Northwest") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)
 
d6 <- ggplot(west,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("West") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
  color="red", linetype="dashed", size=1)

multiplot(d1, d2, d3, d4, d5, d6, cols=3)
```

```{r Histogram of Travel Pattern, echo=FALSE, warning= FALSE, message=FALSE}
##Distribution of Travel by Pattern ####
c1 <- ggplot(fwy,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Freeways") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
             color="red", linetype="dashed", size=1)

c2 <- ggplot(king,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("King's") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
             color="red", linetype="dashed", size=1)

c3 <- ggplot(secon,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Secondary") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
             color="red", linetype="dashed", size=1)

c4 <- ggplot(tert,aes(x=aadt))+
  geom_histogram(aes(y= ..density..)) + 
  theme(panel.background = element_rect(fill = 'white', colour = 'black')) + 
  geom_histogram(colour="black", fill="grey") + ggtitle("Tertiary") + xlab("AADT") +
  ylab("Frequency") + 
  geom_vline(aes(xintercept=mean(aadt, na.rm=T)),  
             color="red", linetype="dashed", size=1)

multiplot(c1, c2, c3, c4, cols=2)
```

The histograms for the regions show a predictable trend and all are positively skewed. Less populated regions such as Northwest and Northeast both showcase a larger proportion of lower AADT values than more populated regions such as Central and West. Regions such as Central, Western, and Eastern all showcase a greater proportion of larger AADT values with West being the only region where the lowest AADT values are not the most dominant on the histogram. This can probably be attributed to it's proximity to the Canada-United States border.

```{r Mosiac Plot, echo=FALSE, warning= FALSE, message=FALSE}
##Mosaic Plots ####

library(dplyr)  
library(vcd)
mytable <- table(fil.data$reg,fil.data$travel.pattern) 

mosaicplot(mytable, main="Region vs. Travel Pattern",
           xlab="Travel Pattern",ylab="Region",
           col=c(3:16), legend=TRUE)

#Talk about differences between sqkm landmass and population of north and south ontario
```
  
``` {r Correspondence Analysis, echo=FALSE, warning= FALSE, message=FALSE}  
##Correspondence Analysis for All Regions ####
  
library(ca)
mytable <- table(fil.data$reg,fil.data$travel.pattern)
prop.table(mytable, 1) # row percentages
prop.table(mytable, 2) # column percentages
fit <- ca(mytable)
print(fit) # basic results 
summary(fit) # extended results 
plot(fit) # symmetric map
plot(fit, mass = TRUE, contrib = "absolute", map =
       "rowgreen", arrows = c(FALSE, TRUE)) # asymmetric map  
  
```


##Predictions

```{r Linear Modelling All Regions, echo=FALSE, warning= FALSE, message=FALSE}

```

```{r Linear Modelling Central, echo=FALSE, warning= FALSE, message=FALSE}

```

```{r Linear Modelling Eastern, echo=FALSE, warning= FALSE, message=FALSE}

```

```{r Linear Modelling Northeastern, echo=FALSE, warning= FALSE, message=FALSE}

```

```{r Linear Modelling Northwestern, echo=FALSE, warning= FALSE, message=FALSE}

```

```{r Linear Modelling Western, echo=FALSE, warning= FALSE, message=FALSE}

```
